---
output: html_notebook
---

<center><h4>Mini research project. <br>
Team: Denys Datsko, Bernaszikovskyi Viacheslav, Hrytsay Maksym</h4></center>

### Intro
Our topic is about chess, because we like to play chess and want to know a little bit more about this game.

We found a good data at https://www.ficsgames.org/download.html
This is a set of many chess games from some internet platdorms

We downloaded the data for the whole 2019 year in blitz mode. There are about 4 million games.

It was in .PGN format, so we made a parser in Python to get all the data in convenient .CSV format.

In the .csv file we have 4 columns representing the rating of a player, whether he made a castling, whether he won and the number of the move, castling was made on.



```{r}
library("BSDA")
install.packages("fitdistrplus")
library("fitdistrplus")
```

```{r}
df <- read.csv2("whole_year_2019_blitz.csv", header=TRUE, sep=",")

ratios <- data.frame(rating = seq(1000, 2100, by=20), all=0, castling=0)
success <- data.frame(rating = seq(1000, 2100, by=20), castling=0, wins=0)
overal <- data.frame(rating = seq(1000, 2100, by=20), games=0, wins=0)
```


```{r}
for (i in ratios$rating) {
  ratios$all[ratios$rating == i] = length(df$rating[df$rating %in% seq(i, i + 20)])
  ratios$castling[ratios$rating == i] = sum(df$castling[df$rating %in% seq(i, i + 20)])
  
  overal$games[overal$rating == i] = ratios$all[ratios$rating == i]
  
  won <- df[df$rating %in% seq(i, i + 20),]
  won <- as.numeric(won$victory) == 3
  overal$wins[overal$rating == i] = sum(won)
  
  with_castling <- df[as.numeric(df$castling)==1,]
  with_castling <- with_castling[with_castling$rating %in% seq(i, i + 20),]
  
  success$castling[success$rating == i] = length(with_castling$rating)
  with_castling <- with_castling[as.numeric(with_castling$victory) == 3,]
  success$wins[success$rating == i] <- length(with_castling$rating)
}
```

```{r}

plot(x = overal$rating, y = overal$wins / overal$games, type="l")

```

```{r}
plot(x = success$rating, y = success$wins / success$castling, type="l")
```


```{r}
plot(x = ratios$rating, y = ratios$castling / ratios$all, type="l")
```



```{r}
func <- success$wins / success$castling ~ success$rating
linear_model = lm(func)
summary(linear_model)

plot(func, col="blue", pch=16)
abline(linear_model, col="red")
```

```{r}
data_wins <- df$victory[as.numeric(df$victory) != 2]
length(df$victory)

data.castling_wins = df$victory[df$castling == 1]
data.castling_wins = data.castling_wins #[as.numeric(data.castling_wins) != 2]


x <- as.numeric(as.character(data_wins))
y = as.numeric(as.character(data.castling_wins))
t.test(x = x, y = y, alternative="two.sided")
```

```{r}
data.no_castling <- df$victory[df$castling==0]
data.no_castling_wins <- data.no_castling #[as.numeric(data.no_castling) != 2]
x <- as.numeric(as.character(data_wins))
y <- as.numeric(as.character(data.no_castling_wins))
t.test(x=x, y=y, alternative="two.sided")
```

```{r}
castling_moves = df$move_number[df$move_number != 0]
hist(castling_moves, breaks=seq(2, 55), probability=T)


descdist(castling_moves)
fit.gamma <- fitdist(castling_moves, "gamma")
plot(fit.gamma)
```

```{r}
fit.gamma
shape <- fit.gamma$estimate[1]
rate <- fit.gamma$estimate[2]

ks.test(castling_moves, "pgamma", shape=shape, rate=rate)
```

